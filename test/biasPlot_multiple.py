import ROOT
import collections
import optparse
#ROOT.gROOT.Reset();
#ROOT.gROOT.SetStyle('Plain')
#ROOT.gStyle.SetPalette(1)
#ROOT.gStyle.SetOptStat(0)
#ROOT.gROOT.SetBatch()        # don't pop up canvases
#ROOT.TH1.AddDirectory(False)
from array import array
from Stat.Limits.samples.toPlot import samples
from Stat.Limits.settings import *



Merged=True
#Merged=False

Resolved=not Merged

Combined=False
#Combined=True
suffix="_18_testw"

if Merged:

#Old
#    pulls=[0.18,0.036,0.11]
#    sigmas=[0.8,0.52,0.45]
#
#    pulls_1s=[0.08,-0.50,-0.49]
#    sigmas_1s=[0.8,0.53,0.45]
#    
#    pulls_limit=[0.047,-0.48,-0.64]
#    sigmas_limit=[0.8,0.53,0.52]
#    
#    pulls_3s=[0.34,-0.22,-0.41]
#    sigmas_3s=[0.8,0.53,0.52]
#    
#    pulls_5s=[0.26,-0.16,-0.26]
#    sigmas_5s=[0.8,0.53,0.52]
#
#New    
    suffix="_18_testw"
    pulls=[0.070172900014,-0.136524076427,-0.00783130944637]
    sigmas=[0.897887215679,0.914796444821,0.855281881919]
    pulls_1s=[0.206815122129,0.0666600913356,-0.0184470733815]
    sigmas_1s=[0.687850502472,0.691700534873,0.733505434946]
    pulls_limit=[0.0754446286897,-0.0553932326081,-0.111624482351]
    sigmas_limit=[0.834856176512,0.781879439008,0.706944439162]
    pulls_3s=[0.0824676584248,-0.170041628832,-0.125052427293]
    sigmas_3s=[0.671776945862,0.585891643734,0.755473536379]
    pulls_5s=[0.035709990989,-0.0403040905091,-0.0616639378537]
    sigmas_5s=[0.544675754699,0.395564927268,0.46193564106]
    #
    suffix="_testw"
    pulls=[-0.276741767795,-0.165703662855,-0.0552931868791]
    sigmas=[0.844668543472,1.00415962634,0.897738556499]
    pulls_1s=[0.0182944187831,-0.143953522069,0.0155538992928]
    sigmas_1s=[0.888650624871,0.80621059748,0.880445418402]
    pulls_limit=[0.165177617008,-0.110772043404,-0.205135151047]
    sigmas_limit=[0.796195840325,0.681602451206,0.765649502708]
    pulls_3s=[0.143040536845,-0.0949961967404,-0.0550851856949]
    sigmas_3s=[0.520975915013,0.338795053773,0.617032082178]
    pulls_5s=[0.230659119408,-0.0464831016511,-0.0462917785578]
    sigmas_5s=[0.285589816657,0.26131586493,0.391162598757]
	
    suffix="testwfull17"
    pulls=[-0.328349841132,-0.16523333464,-0.19618977223]
    sigmas=[0.970642415268,0.894925725251,0.917198595253]
    pulls_1s=[-0.240367273294,-0.148365654119,-0.153326818069]
    sigmas_1s=[0.991975184378,0.858042556362,0.982822558896]
    pulls_limit=[-0.0748473634263,-0.240348677243,-0.324205806076]
    sigmas_limit=[1.01539985516,0.863185621108,0.935316678486]
    pulls_3s=[0.163231183399,-0.190806632286,-0.205320547699]
    sigmas_3s=[0.898308717246,0.772089005205,0.7840901414]
    pulls_5s=[0.0816996957538,-0.228952300422,-0.217039406745]
    sigmas_5s=[0.649768943913,0.787777609174,0.767779715617]

    suffix="testwfull16"
    pulls=[0.0279699495753,-0.0238544886824,-0.0213978068678]
    sigmas=[0.932890714637,0.904733545509,0.878858430089]
    pulls_1s=[0.00940054627382,-0.00241190866635,-0.0192195333149]
    sigmas_1s=[0.987601922019,0.883060409355,0.850399681513]
    pulls_limit=[0.0551757384441,-0.0704967568459,-0.0930807233278]
    sigmas_limit=[0.920002873456,0.885705421283,0.841943280933]
    pulls_3s=[0.17694286412,-0.0429720299107,-0.134480198861]
    sigmas_3s=[0.836100557598,0.704142752817,0.832450516459]
    pulls_5s=[0.0570108079426,-0.0763188510062,-0.114424224169]
    sigmas_5s=[0.575711764094,0.639174438055,0.655219613035]

    suffix="testwfull18"
    pulls=[0.0816938086846,-0.065441050483,-0.141406766269]
    sigmas=[0.86140169313,0.89880724548,0.92385416731]
    pulls_1s=[-0.0220650759804,-0.0565474482313,-0.127354976108]
    sigmas_1s=[0.815944763056,0.817551790344,0.88255959834]
    pulls_limit=[-0.0866163930718,-0.190096997459,-0.0389725514369]
    sigmas_limit=[0.965744522305,0.907338976306,0.819683914717]
    pulls_3s=[0.115305669847,-0.115864253257,-0.183084538244]
    sigmas_3s=[0.827588775467,0.645120921006,0.816998714936]
    pulls_5s=[0.118254368354,-0.108893823414,-0.0663465105976]
    sigmas_5s=[0.636977372705,0.569756500251,0.630852868462]


    suffix="testwddunc"
    pulls=[-0.371601846235,-0.21054378712,-0.176660763044]
    sigmas=[0.928231217994,0.958151038235,0.949506415374]
    pulls_1s=[-0.269723007594,-0.359209442985,-0.207046689696]
    sigmas_1s=[0.935944997852,0.946313737012,0.863686469836]
    pulls_limit=[0.0642019329573,-0.259386982175,-0.259994946099]
    sigmas_limit=[0.90799501162,0.880576680617,0.818216922791]
    pulls_3s=[0.314132418005,-0.115643182264,-0.181014058894]
    sigmas_3s=[0.723685435634,0.545405266004,0.630135728696]
    pulls_5s=[0.148168766206,-0.0632336101533,-0.179370539979]
    sigmas_5s=[0.670624826916,0.494771407253,0.640620156145]

    pulls=[-0.182481411797,-0.157322831197,-0.145039679208]
    sigmas=[0.961372909956,1.12262386613,0.886787659356]
    pulls_1s=[-0.0948732925769,-0.286821085056,-0.0521517832986]
    sigmas_1s=[0.957154984838,0.953968134762,0.793407551401]
    pulls_limit=[-0.115968598781,-0.0634451523983,-0.153709809597]
    sigmas_limit=[1.04253076531,0.851886430377,0.997010333464]
    pulls_3s=[0.279600712087,-0.250072189105,-0.238555461297]
    sigmas_3s=[0.815962319936,0.710308247124,0.656743745224]
    pulls_5s=[0.0926860852495,-0.148466769314,0.0553133076476]
    sigmas_5s=[0.610827997579,0.488854978435,0.642431488699]

    pulls=[-0.323439761655,-0.172865093847,-0.0366980474175]
    sigmas=[1.10983474813,1.0649766191,0.807328784441]
    pulls_1s=[-0.0504937675242,-0.404382906267,-0.0827739324523]
    sigmas_1s=[0.899015418432,0.852507349508,0.805821879049]
    pulls_limit=[-0.212285588825,-0.113196964465,-0.0763152897968]
    sigmas_limit=[1.05630842754,0.95341345058,0.871543812455]
    pulls_3s=[0.237137071393,-0.247599025866,-0.195248221462]
    sigmas_3s=[0.772325466842,0.60675856508,0.645506978148]
    pulls_5s=[0.161193134274,-0.103189517126,0.0556661959268]
    sigmas_5s=[0.653220014472,0.357415719513,0.720200533704]

    pulls=[-0.237789689364,-0.248649263215,0.0998675376837]
    sigmas=[1.0169378208,0.825487738742,1.13644006122]
    pulls_1s=[-0.268750203117,-0.204688909682,-0.152262616964]
    sigmas_1s=[1.03060174315,0.985240145235,1.04035068543]
    pulls_limit=[-0.154799645195,-0.0738781064194,-0.0674508630612]
    sigmas_limit=[0.82540974416,0.777922362829,0.804639684128]
    pulls_3s=[0.161558440176,-0.108914890562,-0.154329945491]
    sigmas_3s=[0.772493609695,0.600414046589,0.736810354748]
    pulls_5s=[-0.167506229143,-0.0530019223928,-0.0240878998785]
    sigmas_5s=[0.800463967094,0.349165884186,0.618770703411]

    #nosmooth noz    
    pulls=[-0.39767164044,0.0749262532673,-0.0230671849128]
    sigmas=[0.999376563766,0.937020994102,0.86297040957]
    pulls_1s=[-0.139314823524,-0.29303637326,-0.128124685083]
    sigmas_1s=[1.00775596412,0.940870565519,0.922080532066]
    pulls_limit=[0.0144020348465,-0.108386207313,-0.087498042842]
    sigmas_limit=[0.900180978515,0.945634940139,0.735546229651]
    pulls_3s=[0.214900325105,-0.157251712345,-0.106213851011]
    sigmas_3s=[0.889632855383,0.472421649778,0.610136262046]
    pulls_5s=[0.0489595079975,-0.0337420140624,0.0358005906084]
    sigmas_5s=[0.759120338261,0.377394307665,0.773633630475]
    #bigsmooth
    pulls=[-0.232699740877,-0.238029706636,0.0924451752007]
    sigmas=[1.04103505233,0.895115425597,0.98395192979]
    pulls_1s=[-0.200983404264,-0.278542760921,0.0133380638111]
    sigmas_1s=[0.901781082177,0.991005578863,1.11345781527]
    pulls_limit=[0.0532722300005,-0.293575651079,-0.253540610448]
    sigmas_limit=[0.869739329513,0.865987795279,0.939041982706]
    pulls_3s=[0.380709443867,-0.167876474492,-0.217432978925]
    sigmas_3s=[0.611308741136,0.631139336824,0.869038609955]
    pulls_5s=[0.107937468108,-0.114244114364,-0.12821241275]
    sigmas_5s=[0.721610587837,0.377659093063,0.564014457779]

    pulls=[-0.358251034054,0.0459209360315,0.0525181150946]
    sigmas=[0.87211112153,0.935743663166,0.971320218813]
    pulls_1s=[-0.160004082169,-0.145226581119,0.0535673014655]
    sigmas_1s=[1.01531742376,0.885938710446,0.962880438586]
    pulls_limit=[-0.0630338879504,-0.154258080933,0.0116101881145]
    sigmas_limit=[1.00392800037,0.845155321049,0.780696410403]
    pulls_3s=[0.165616230475,-0.0783191221608,-0.0307274196019]
    sigmas_3s=[0.775703039647,0.583787731242,0.703458464574]
    pulls_5s=[0.208778889434,-0.00104227908872,0.0787513656174]
    sigmas_5s=[0.539110437743,0.464912839666,0.801437654804]



    pulls=[-0.415895154758,-0.132910913912,-0.00341884219445]
    sigmas=[0.97754158828,0.988382192177,0.99374669726]
    pulls_1s=[-0.197913443362,-0.225695703828,-0.179164769227]
    sigmas_1s=[1.0280285345,0.927497292875,0.953339199207]
    pulls_limit=[-0.0717664724999,-0.280721567685,-0.0212056806824]
    sigmas_limit=[0.977701541963,0.910934812998,0.957323143679]
    pulls_3s=[0.240979491916,-0.0783938025967,-0.00175225153785]
    sigmas_3s=[0.796106182504,0.696003983989,0.799444834571]
    pulls_5s=[0.233010347368,-0.0318799445039,-0.203351159446]
    sigmas_5s=[0.577982150961,0.466832536231,0.798802621664]

#    pulls=[-0.260227795719,-0.180143634881,-0.132861000772]
#    sigmas=[1.08723297518,0.945758013472,0.914490768603]
#    pulls_1s=[-0.0483258894305,-0.217024805253,-0.105900478564]
#    sigmas_1s=[1.06443648602,0.909555811126,0.980647050279]
#    pulls_limit=[0.0903277333585,-0.167448375121,-0.174060889895]
#    sigmas_limit=[0.894872003439,0.83788502943,0.737553712156]
#    pulls_3s=[0.385620210473,-0.101456703337,-0.124123416208]
#    sigmas_3s=[0.6629684354,0.654973292319,0.656381917557]
#    pulls_5s=[0.0749133632608,-0.0743308480145,-0.0353517638561]
#    sigmas_5s=[0.683027717649,0.466370885861,0.719987685385]

#    pulls=[-0.0766586234475,-0.19613321359,-0.0432613913123]
#    sigmas=[1.00965880484,0.918878578955,0.999982243586]
#    pulls_1s=[-0.00151100982406,-0.269179819852,-0.0248721587101]
#    sigmas_1s=[0.9966111167,0.962762188515,1.02957603083]
#    pulls_limit=[0.130025787267,-0.222091722623,-0.185254480215]
#    sigmas_limit=[0.940274965892,0.877678439739,0.772512682635]
#    pulls_3s=[0.469935415523,-0.0791331256864,-0.0788215957571]
#    sigmas_3s=[0.682206415041,0.553821927212,0.63650455445]
#    pulls_5s=[0.235623532605,-0.086681930599,0.0059299415805]
#    sigmas_5s=[0.617825767247,0.458222297041,0.776208248914]


    finalstr="Merged"

if Resolved:
    pulls=[0.34,0.33,0.27]
    sigmas=[0.8,0.52,0.45]

    pulls_1s=[0.08,0.125,-0.01]
    sigmas_1s=[0.8,0.53,0.45]
    
    pulls_limit=[-0.16,-0.01,-0.25]
    sigmas_limit=[0.8,0.53,0.52]
    
    pulls_3s=[-0.26,-0.17,-0.02]
    sigmas_3s=[0.8,0.53,0.52]
    
    pulls_5s=[0.22,-0.003,+0.17]
    sigmas_5s=[0.8,0.53,0.52]

    finalstr="Resolved"

if Combined:
    pulls=[0.28,0.10,0.12]
    sigmas=[0.8,0.52,0.45]

    pulls_1s=[-0.06,-0.28,-0.45]
    sigmas_1s=[0.8,0.53,0.45]
    
    pulls_limit=[-0.009,-0.41,-0.5]
    sigmas_limit=[0.8,0.53,0.52]
    
    pulls_3s=[0.02,-0.33,-0.431]
    sigmas_3s=[0.8,0.53,0.52]
    
    pulls_5s=[0.05,-0.07,-0.32]
    sigmas_5s=[0.8,0.53,0.52]

    finalstr="Combined"


points = [700,1100,1500]

sigmas_0=[0.01,0.01,0.01]


pval = array("f",pulls) 
sval = array("f",sigmas) 

pval_1s = array("f",pulls_1s) 
sval_1s = array("f",sigmas_1s) 

pval_limit = array("f",pulls_limit) 
sval_limit = array("f",sigmas_limit) 

pval_3s = array("f",pulls_3s) 
sval_3s = array("f",sigmas_3s) 

pval_5s = array("f",pulls_5s) 
sval_5s = array("f",sigmas_5s) 

sval = array("f",sigmas_0);
xval = array("f",points) 
#//sbar = [ pulls[m]- for m in pulls]
xbar = array('f', [0]*len(points))
#xbar2 = array('f', [0]*len(l.v))



pull = ROOT.TGraphErrors(len(points),xval,pval,xbar,sval)
pull_1s = ROOT.TGraphErrors(len(points),xval,pval_1s,xbar,sval)
pull_limit = ROOT.TGraphErrors(len(points),xval,pval_limit,xbar,sval)
pull_3s = ROOT.TGraphErrors(len(points),xval,pval_3s,xbar,sval)
pull_5s = ROOT.TGraphErrors(len(points),xval,pval_5s,xbar,sval)


pull.SetTitle("Pulls");
pull.GetYaxis().SetTitle("r-r_{in}/#sigma_{r}");

pull.GetYaxis().SetRangeUser(-2,2)
pull.SetMarkerStyle(20)
pull.SetFillStyle(0)

pull_1s.GetYaxis().SetRangeUser(-2,2)
pull_1s.SetMarkerStyle(20)
pull_1s.SetMarkerColor(ROOT.kBlue)
pull_1s.SetLineColor(ROOT.kBlue)
pull_1s.SetFillStyle(0)

pull_3s.GetYaxis().SetRangeUser(-2,2)
pull_3s.SetMarkerStyle(20)
pull_3s.SetMarkerColor(ROOT.kOrange)
pull_3s.SetLineColor(ROOT.kOrange)
pull_3s.SetFillStyle(0)

pull_5s.GetYaxis().SetRangeUser(-2,2)
pull_5s.SetMarkerStyle(20)
pull_5s.SetMarkerColor(ROOT.kRed)
pull_5s.SetLineColor(ROOT.kRed)
pull_5s.SetFillStyle(0)

pull_limit.GetYaxis().SetRangeUser(-2,2)
pull_limit.SetMarkerStyle(20)
pull_limit.SetMarkerColor(ROOT.kGreen)
pull_limit.SetLineColor(ROOT.kGreen)
pull_limit.SetFillStyle(0)


legend = ROOT.TLegend(0.695,0.55,0.93,0.90)
legend.SetTextSize(0.036);
legend.SetFillStyle(0);
legend.SetBorderSize(0);
legend.AddEntry(pull,"r = 0");
legend.AddEntry(pull_1s," 1 sigma");
legend.AddEntry(pull_limit," r = limit ");
legend.AddEntry(pull_3s," 3 sigma");
legend.AddEntry(pull_5s," 5 sigma");


c1 = ROOT.TCanvas()
ROOT.SetOwnership(c1, False)
c1.cd()
c1.SetGrid() 
#c1.SetLogy(1)
pull.Draw("APL")
pull_1s.Draw("PL")
pull_limit.Draw("PL ")
pull_3s.Draw("PL ")
pull_5s.Draw("PL ")
legend.Draw()
finalstr+=suffix
c1.SaveAs("Pulls_Multiple_"+finalstr+".png")


